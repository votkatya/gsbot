<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug Page - –ì–æ—Ä–æ–¥ –°–ø–æ—Ä—Ç–∞</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    .section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .success { background-color: #d4edda; border-color: #c3e6cb; }
    .error { background-color: #f8d7da; border-color: #f5c6cb; }
    .info { background-color: #d1ecf1; border-color: #bee5eb; }
    pre {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .test-item {
      margin: 10px 0;
      padding: 10px;
      background: white;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ì–æ—Ä–æ–¥ –°–ø–æ—Ä—Ç–∞</h1>

  <div class="section info">
    <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è</h2>
    <div id="env-check"></div>
  </div>

  <div class="section info">
    <h2>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram WebApp</h2>
    <div id="tg-check"></div>
  </div>

  <div class="section info">
    <h2>3. –ü—Ä–æ–≤–µ—Ä–∫–∞ API</h2>
    <div id="api-check"></div>
  </div>

  <div class="section info">
    <h2>4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Å—Å–µ—Ç–æ–≤</h2>
    <div id="assets-check"></div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    // 1. Environment Check
    const envCheck = document.getElementById('env-check');
    envCheck.innerHTML = `
      <div class="test-item">
        <strong>URL:</strong> ${window.location.href}<br>
        <strong>Protocol:</strong> ${window.location.protocol}<br>
        <strong>Host:</strong> ${window.location.host}<br>
        <strong>Pathname:</strong> ${window.location.pathname}<br>
        <strong>User Agent:</strong> ${navigator.userAgent}<br>
        <strong>Current Time:</strong> ${new Date().toISOString()}
      </div>
    `;

    // 2. Telegram WebApp Check
    const tgCheck = document.getElementById('tg-check');
    const tg = window.Telegram?.WebApp;

    if (tg) {
      tg.ready();
      const user = tg.initDataUnsafe?.user;
      const startParam = tg.initDataUnsafe?.start_param;

      tgCheck.innerHTML = `
        <div class="test-item success">
          ‚úÖ Telegram WebApp SDK –∑–∞–≥—Ä—É–∂–µ–Ω<br>
          <strong>Version:</strong> ${tg.version || 'unknown'}<br>
          <strong>Platform:</strong> ${tg.platform || 'unknown'}<br>
          <strong>User ID:</strong> ${user?.id || 'not found'}<br>
          <strong>Username:</strong> ${user?.username || 'not found'}<br>
          <strong>First Name:</strong> ${user?.first_name || 'not found'}<br>
          <strong>Start Param:</strong> ${startParam || 'none'}<br>
          <strong>Init Data:</strong> ${tg.initData ? 'present' : 'missing'}
        </div>
      `;
    } else {
      tgCheck.innerHTML = `
        <div class="test-item error">
          ‚ùå Telegram WebApp SDK –Ω–µ –Ω–∞–π–¥–µ–Ω<br>
          –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏–∑ Telegram
        </div>
      `;
    }

    // 3. API Check
    const apiCheck = document.getElementById('api-check');
    const API_BASE = 'https://gsbot18.ru';

    async function testAPI() {
      try {
        const testId = tg?.initDataUnsafe?.user?.id || 123456789;

        apiCheck.innerHTML += `<div class="test-item">‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ API: ${API_BASE}/api/user/${testId}</div>`;

        const response = await fetch(`${API_BASE}/api/user/${testId}`, {
          method: 'GET',
          headers: {
            'Accept': 'application/json',
          }
        });

        const data = await response.json();

        if (response.ok) {
          apiCheck.innerHTML += `
            <div class="test-item success">
              ‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω<br>
              <strong>Status:</strong> ${response.status}<br>
              <strong>Response:</strong> <pre>${JSON.stringify(data, null, 2)}</pre>
            </div>
          `;
        } else {
          apiCheck.innerHTML += `
            <div class="test-item error">
              ‚ö†Ô∏è API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É<br>
              <strong>Status:</strong> ${response.status}<br>
              <strong>Response:</strong> <pre>${JSON.stringify(data, null, 2)}</pre>
            </div>
          `;
        }
      } catch (error) {
        apiCheck.innerHTML += `
          <div class="test-item error">
            ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ API<br>
            <strong>Error:</strong> ${error.message}<br>
            <strong>Stack:</strong> <pre>${error.stack}</pre>
          </div>
        `;
      }
    }

    testAPI();

    // 4. Assets Check
    const assetsCheck = document.getElementById('assets-check');
    const assetsToCheck = [
      '/assets/index-D9_RnF4v.js',
      '/assets/index-wjuNMKg6.css'
    ];

    async function checkAssets() {
      for (const asset of assetsToCheck) {
        try {
          const response = await fetch(asset, { method: 'HEAD' });

          if (response.ok) {
            assetsCheck.innerHTML += `
              <div class="test-item success">
                ‚úÖ ${asset} - OK (${response.status})<br>
                <strong>Content-Type:</strong> ${response.headers.get('content-type')}<br>
                <strong>Content-Length:</strong> ${response.headers.get('content-length')} bytes
              </div>
            `;
          } else {
            assetsCheck.innerHTML += `
              <div class="test-item error">
                ‚ùå ${asset} - ${response.status} ${response.statusText}
              </div>
            `;
          }
        } catch (error) {
          assetsCheck.innerHTML += `
            <div class="test-item error">
              ‚ùå ${asset} - –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}
            </div>
          `;
        }
      }
    }

    checkAssets();

    // Log everything to console as well
    console.log('=== DEBUG INFO ===');
    console.log('Location:', window.location);
    console.log('Telegram WebApp:', window.Telegram?.WebApp);
    console.log('User Agent:', navigator.userAgent);
  </script>
</body>
</html>
